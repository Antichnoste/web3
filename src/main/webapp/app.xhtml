<!DOCTYPE html>
<html xmlns="http://www.w.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>мямямяму</title>
    <h:outputStylesheet library="css" name="app.css"/>
    <h:outputScript library="js" name="graph.js" target="body"/>
</h:head>

<h:body>
    <h:form id="appForm">

        <h2>Проверка попадания точки в область</h2>

        <h:panelGrid columns="2" columnClasses="col, col" styleClass="block">

            <h:panelGroup>
                <h:outputText value="X:"/><br/>
                <p:selectOneRadio id="x" value="#{form.x}" layout="grid" columns="5">
                    <f:selectItems value="#{settings.XOptions}"/>
                </p:selectOneRadio>
                <p:message for="x"/>
            </h:panelGroup>

            <h:panelGroup>
                <h:outputText value="Y (−5..5):"/><br/>
                <p:inputText id="y" value="#{form.y}" maxlength="12">
                    <f:validator validatorId="yValidator"/>
                    <p:ajax update="ymsg"/>
                </p:inputText>
                <p:message id="ymsg" for="y"/>
            </h:panelGroup>

            <h:panelGroup>
                <h:outputText value="R:"/><br/>
                <p:selectOneRadio id="r" value="#{form.r}" layout="grid" columns="5">
                    <f:selectItems value="#{settings.ROptions}"/>
                    <p:ajax update=":appForm:graph :appForm:rValue"
                            oncomplete="redrawAll();"/>
                </p:selectOneRadio>
            </h:panelGroup>

            <h:panelGroup>
                <p:commandButton value="Проверить"
                                 actionListener="#{form.submit}"
                                 update=":appForm:graph :appForm:results"
                                 icon="ui-icon-check"
                                 oncomplete="redrawAll();"/>
                <p:commandButton value="На стартовую" action="toIndex"
                                 styleClass="ui-button-secondary"/>
            </h:panelGroup>
        </h:panelGrid>

        <h:panelGroup id="graph" layout="block" styleClass="graph-wrap">
            <svg id="graphSvg" width="420" height="420"
                 data-center-x="210" data-center-y="210">

                <line x1="210" y1="10" x2="210" y2="410" stroke="black"/>
                <line x1="10" y1="210" x2="410" y2="210" stroke="black"/>

                <g id="ticks"></g>
                <g id="area" fill="#49a8ff" fill-opacity="0.95" stroke="none"></g>

                <g id="pointsLayer">
                    <ui:repeat value="#{results.data}" var="p">
                        <circle class="#{p.hit ? 'hit' : 'miss'}"
                                r="3"
                                data-x="#{p.x}" data-y="#{p.y}" data-r="#{p.r}"/>
                    </ui:repeat>
                </g>

                <text x="395" y="205" font-size="12">x</text>
                <text x="215" y="20"  font-size="12">y</text>
            </svg>
        </h:panelGroup>

        <p:remoteCommand name="rcSendPoint"
                         process="@this :appForm:r"
                         action="#{form.submitFromGraph}"
                         update=":appForm:graph :appForm:results"
                         oncomplete="redrawAll();">
            <f:setPropertyActionListener target="#{form.graphX}" value="#{param.x}"/>
            <f:setPropertyActionListener target="#{form.graphY}" value="#{param.y}"/>
        </p:remoteCommand>

        <h:inputHidden id="rValue" value="#{form.r}"/>

        <h3>История проверок</h3>
        <p:dataTable id="results" value="#{results.data}" var="row"
                     scrollable="true" scrollHeight="260"
                     styleClass="block" rowIndexVar="i">
            <p:column headerText="#" style="width:4em">#{i + 1}</p:column>
            <p:column headerText="X">#{row.x}</p:column>
            <p:column headerText="Y">#{row.y}</p:column>
            <p:column headerText="R">#{row.r}</p:column>
            <p:column headerText="Попадание"><h:outputText value="#{row.hit ? 'Да' : 'Нет'}"/></p:column>
            <p:column headerText="Время">#{row.createdAt}</p:column>
        </p:dataTable>

    </h:form>
</h:body>
</html>